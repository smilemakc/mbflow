# =============================================================================
# MBFlow Backend Configuration
# =============================================================================
# Copy this file to .env and adjust values for your environment

# =============================================================================
# Server Configuration
# =============================================================================

# Server port (default: 8585)
MBFLOW_PORT=8585

# Server host (default: 0.0.0.0)
MBFLOW_HOST=0.0.0.0

# Request timeouts
MBFLOW_READ_TIMEOUT=15s
MBFLOW_WRITE_TIMEOUT=15s
MBFLOW_SHUTDOWN_TIMEOUT=30s

# Enable CORS for browser clients (default: true)
MBFLOW_CORS_ENABLED=true

# API keys for service authentication (comma-separated)
# Used for server-to-server communication
MBFLOW_API_KEYS=your-api-key-1,your-api-key-2

# =============================================================================
# Database Configuration (PostgreSQL)
# =============================================================================

# PostgreSQL connection string (required)
MBFLOW_DATABASE_URL=postgres://mbflow:mbflow@localhost:5432/mbflow?sslmode=disable

# Connection pool settings
MBFLOW_DB_MAX_CONNECTIONS=20
MBFLOW_DB_MIN_CONNECTIONS=5
MBFLOW_DB_MAX_IDLE_TIME=30m
MBFLOW_DB_MAX_CONN_LIFETIME=1h

# =============================================================================
# Redis Configuration (optional, for caching)
# =============================================================================

MBFLOW_REDIS_URL=redis://localhost:6379
MBFLOW_REDIS_PASSWORD=
MBFLOW_REDIS_DB=0
MBFLOW_REDIS_POOL_SIZE=10

# =============================================================================
# Logging Configuration
# =============================================================================

# Log level: debug, info, warn, error (default: info)
MBFLOW_LOG_LEVEL=info

# Log format: json, text (default: json)
MBFLOW_LOG_FORMAT=json

# =============================================================================
# Authentication Configuration
# =============================================================================

# Authentication mode (required):
#   builtin      - Local database authentication only
#   grpc         - gRPC auth-gateway only (no local fallback)
#   grpc_hybrid  - gRPC auth-gateway with local fallback
#   gateway      - OIDC/OAuth2 gateway only
#   hybrid       - OIDC/OAuth2 with local fallback
MBFLOW_AUTH_MODE=builtin

# JWT Configuration (required for: builtin, hybrid, grpc_hybrid)
# Secret key for signing JWT tokens (min 32 characters)
MBFLOW_JWT_SECRET=your-super-secret-key-min-32-characters-long

# Token expiration
MBFLOW_JWT_EXPIRATION_HOURS=24
MBFLOW_JWT_REFRESH_DAYS=30

# Session settings
MBFLOW_SESSION_DURATION=24h
MBFLOW_MAX_SESSIONS_PER_USER=5

# Password policy
MBFLOW_MIN_PASSWORD_LENGTH=8
MBFLOW_REQUIRE_SPECIAL_CHARS=false
MBFLOW_REQUIRE_UPPERCASE=false
MBFLOW_REQUIRE_NUMBERS=false

# Rate limiting for login attempts
MBFLOW_ENABLE_RATE_LIMIT=true
MBFLOW_MAX_LOGIN_ATTEMPTS=5
MBFLOW_LOCKOUT_DURATION=15m

# Allow new user registration (default: true)
MBFLOW_ALLOW_REGISTRATION=true

# -----------------------------------------------------------------------------
# gRPC Auth Gateway (for modes: grpc, grpc_hybrid)
# -----------------------------------------------------------------------------

# =============================================================================
# gRPC Auth-Gateway Integration
# =============================================================================
MBFLOW_AUTH_GRPC_ADDRESS=:50051
MBFLOW_GRPC_SERVICE_API_ENABLED=true
# gRPC request timeout
MBFLOW_AUTH_GRPC_TIMEOUT=10s
MBFLOW_AUTH_APPLICATION_ID=
MBFLOW_AUTH_CLIENT_NAME=mbflow
MBFLOW_AUTH_CLIENT_VERSION=
MBFLOW_AUTH_PLATFORM=
MBFLOW_AUTH_ENVIRONMENT=
# -----------------------------------------------------------------------------
# OIDC/OAuth2 Gateway (for modes: gateway, hybrid)
# -----------------------------------------------------------------------------

# Auth gateway base URL
MBFLOW_AUTH_GATEWAY_URL=https://auth.example.com

# OAuth2 client credentials
MBFLOW_AUTH_CLIENT_ID=your-client-id
MBFLOW_AUTH_CLIENT_SECRET=your-client-secret

# OIDC issuer URL for token validation
MBFLOW_AUTH_ISSUER_URL=https://auth.example.com

# JWKS URL for token signature verification
MBFLOW_AUTH_JWKS_URL=https://auth.example.com/.well-known/jwks.json

# OAuth2 redirect URL after authentication
MBFLOW_AUTH_REDIRECT_URL=http://localhost:8585/api/v1/auth/callback

# -----------------------------------------------------------------------------
# Fallback Configuration
# -----------------------------------------------------------------------------

# Enable fallback to secondary auth provider (default: false)
# Note: grpc_hybrid and hybrid modes automatically enable fallback
MBFLOW_AUTH_ENABLE_FALLBACK=false

# Fallback mode when primary fails (default: builtin)
MBFLOW_AUTH_FALLBACK_MODE=builtin

# =============================================================================
# Observer Configuration (Real-time Monitoring)
# =============================================================================

# Database observer - stores events in PostgreSQL
MBFLOW_OBSERVER_DB_ENABLED=true

# Logger observer - logs events to stdout
MBFLOW_OBSERVER_LOGGER_ENABLED=true

# WebSocket observer - real-time updates to clients
MBFLOW_OBSERVER_WEBSOCKET_ENABLED=true
MBFLOW_OBSERVER_WEBSOCKET_BUFFER_SIZE=256

# HTTP callback observer - sends events to external URL
MBFLOW_OBSERVER_HTTP_ENABLED=false
MBFLOW_OBSERVER_HTTP_URL=https://your-webhook.example.com/events
MBFLOW_OBSERVER_HTTP_METHOD=POST
MBFLOW_OBSERVER_HTTP_TIMEOUT=10s
MBFLOW_OBSERVER_HTTP_MAX_RETRIES=3
MBFLOW_OBSERVER_HTTP_RETRY_DELAY=1s
# Headers format: "Key1:Value1,Key2:Value2"
MBFLOW_OBSERVER_HTTP_HEADERS=Authorization:Bearer token,X-Custom:value

# Event buffer size for observers
MBFLOW_OBSERVER_BUFFER_SIZE=100

# =============================================================================
# File Storage Configuration
# =============================================================================

# Maximum file size for uploads (default: 10MB)
MBFLOW_FILE_STORAGE_MAX_FILE_SIZE=10485760

# Local storage path for files
MBFLOW_FILE_STORAGE_PATH=./data/storage

# =============================================================================
# Service Keys Configuration
# =============================================================================

# Maximum API keys per user
MBFLOW_SERVICE_KEYS_MAX_PER_USER=10

# Default key expiry in days
MBFLOW_SERVICE_KEYS_DEFAULT_EXPIRY_DAYS=365
