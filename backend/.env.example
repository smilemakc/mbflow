# MBFlow Configuration Example
# Copy this file to .env and adjust values as needed

# =============================================================================
# Server Configuration
# =============================================================================
MBFLOW_PORT=8585
MBFLOW_HOST=0.0.0.0
MBFLOW_READ_TIMEOUT=15s
MBFLOW_WRITE_TIMEOUT=15s
MBFLOW_SHUTDOWN_TIMEOUT=30s
MBFLOW_CORS_ENABLED=true
# Comma-separated list of API keys for authentication
# MBFLOW_API_KEYS=key1,key2,key3

# =============================================================================
# Database Configuration
# =============================================================================
MBFLOW_DATABASE_URL=postgres://mbflow:mbflow@localhost:5432/mbflow?sslmode=disable
MBFLOW_DB_MAX_CONNECTIONS=20
MBFLOW_DB_MIN_CONNECTIONS=5
MBFLOW_DB_MAX_IDLE_TIME=30m
MBFLOW_DB_MAX_CONN_LIFETIME=1h

# =============================================================================
# Redis Configuration
# =============================================================================
MBFLOW_REDIS_URL=redis://localhost:6379
MBFLOW_REDIS_PASSWORD=
MBFLOW_REDIS_DB=0
MBFLOW_REDIS_POOL_SIZE=10

# =============================================================================
# Logging Configuration
# =============================================================================
MBFLOW_LOG_LEVEL=info
MBFLOW_LOG_FORMAT=json

# =============================================================================
# Authentication Configuration
# =============================================================================

# Authentication mode: builtin, gateway, grpc, hybrid
# - builtin: Local database authentication with JWT tokens
# - gateway: External OIDC/OAuth2 provider (requires IssuerURL, ClientID)
# - grpc: Auth-gateway gRPC proxy (requires GRPCAddress)
# - hybrid: Gateway primary with builtin fallback
MBFLOW_AUTH_MODE=builtin

# JWT Configuration (required for builtin and hybrid modes)
# Must be at least 32 characters
MBFLOW_JWT_SECRET=your-super-secret-jwt-key-min-32-chars
MBFLOW_JWT_EXPIRATION_HOURS=24
MBFLOW_JWT_REFRESH_DAYS=30

# Session Configuration
MBFLOW_SESSION_DURATION=24h
MBFLOW_MAX_SESSIONS_PER_USER=5

# Password Policy
MBFLOW_MIN_PASSWORD_LENGTH=8
MBFLOW_REQUIRE_SPECIAL_CHARS=false
MBFLOW_REQUIRE_UPPERCASE=false
MBFLOW_REQUIRE_NUMBERS=false

# Rate Limiting
MBFLOW_ENABLE_RATE_LIMIT=true
MBFLOW_MAX_LOGIN_ATTEMPTS=5
MBFLOW_LOCKOUT_DURATION=15m

# Registration
MBFLOW_ALLOW_REGISTRATION=true

# -----------------------------------------------------------------------------
# OIDC/OAuth2 Gateway Configuration (for gateway/hybrid modes)
# -----------------------------------------------------------------------------
# MBFLOW_AUTH_GATEWAY_URL=https://auth.example.com
# MBFLOW_AUTH_CLIENT_ID=mbflow-client
# MBFLOW_AUTH_CLIENT_SECRET=your-client-secret
# MBFLOW_AUTH_ISSUER_URL=https://auth.example.com
# MBFLOW_AUTH_JWKS_URL=https://auth.example.com/.well-known/jwks.json
# MBFLOW_AUTH_REDIRECT_URL=http://localhost:8585/api/v1/auth/oauth/callback

# -----------------------------------------------------------------------------
# gRPC Auth Gateway Configuration (for grpc mode)
# -----------------------------------------------------------------------------
# Address of auth-gateway gRPC server (host:port)
# MBFLOW_AUTH_GRPC_ADDRESS=auth-gateway:50051

# Timeout for gRPC calls (default: 10s)
# MBFLOW_AUTH_GRPC_TIMEOUT=10s

# -----------------------------------------------------------------------------
# Fallback Configuration
# -----------------------------------------------------------------------------
# Enable fallback to secondary provider if primary fails
MBFLOW_AUTH_ENABLE_FALLBACK=false
# Fallback mode: builtin (default)
MBFLOW_AUTH_FALLBACK_MODE=builtin

# =============================================================================
# Service Keys Configuration
# =============================================================================
MBFLOW_SERVICE_KEYS_MAX_PER_USER=10
MBFLOW_SERVICE_KEYS_DEFAULT_EXPIRY_DAYS=365

# =============================================================================
# File Storage Configuration
# =============================================================================
MBFLOW_FILE_STORAGE_MAX_FILE_SIZE=10485760
MBFLOW_FILE_STORAGE_PATH=./data/storage

# =============================================================================
# Observer Configuration
# =============================================================================
MBFLOW_OBSERVER_DB_ENABLED=true
MBFLOW_OBSERVER_LOGGER_ENABLED=true
MBFLOW_OBSERVER_WEBSOCKET_ENABLED=true
MBFLOW_OBSERVER_WEBSOCKET_BUFFER_SIZE=256
MBFLOW_OBSERVER_BUFFER_SIZE=100

# HTTP Callback Observer (optional)
MBFLOW_OBSERVER_HTTP_ENABLED=false
# MBFLOW_OBSERVER_HTTP_URL=https://webhook.example.com/callback
# MBFLOW_OBSERVER_HTTP_METHOD=POST
# MBFLOW_OBSERVER_HTTP_TIMEOUT=10s
# MBFLOW_OBSERVER_HTTP_MAX_RETRIES=3
# MBFLOW_OBSERVER_HTTP_RETRY_DELAY=1s
# MBFLOW_OBSERVER_HTTP_HEADERS=Authorization:Bearer token,X-Custom:value
