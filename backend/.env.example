# =============================================================================
# MBFlow Backend Configuration
# =============================================================================
# Скопируйте этот файл в .env и настройте значения под вашу среду.
# Все значения по умолчанию указаны в комментариях.
# =============================================================================

# =============================================================================
# SERVER CONFIGURATION
# =============================================================================

# Порт, на котором будет запущен сервер
# Default: 8585
MBFLOW_PORT=8585

# Хост для прослушивания (0.0.0.0 для всех интерфейсов)
# Default: 0.0.0.0
MBFLOW_HOST=0.0.0.0

# Таймаут на чтение запроса
# Формат: Go duration (например: 15s, 1m, 500ms)
# Default: 15s
MBFLOW_READ_TIMEOUT=15s

# Таймаут на запись ответа
# Default: 15s
MBFLOW_WRITE_TIMEOUT=15s

# Таймаут на graceful shutdown сервера
# Default: 30s
MBFLOW_SHUTDOWN_TIMEOUT=30s

# Включить CORS для браузерных клиентов
# Default: true
MBFLOW_CORS_ENABLED=true

# API ключи для аутентификации (через запятую)
# Используется для доступа к API без JWT токена
# Default: (пусто)
# Пример: MBFLOW_API_KEYS=key1,key2,key3
MBFLOW_API_KEYS=

# =============================================================================
# DATABASE CONFIGURATION (PostgreSQL)
# =============================================================================

# URL подключения к PostgreSQL
# Формат: postgres://user:password@host:port/database?sslmode=disable
# ОБЯЗАТЕЛЬНО для работы приложения
MBFLOW_DATABASE_URL=postgres://mbflow:mbflow@localhost:5432/mbflow?sslmode=disable

# Максимальное количество соединений в пуле
# Default: 20
MBFLOW_DB_MAX_CONNECTIONS=20

# Минимальное количество соединений в пуле
# Default: 5
MBFLOW_DB_MIN_CONNECTIONS=5

# Максимальное время простоя соединения перед закрытием
# Default: 30m
MBFLOW_DB_MAX_IDLE_TIME=30m

# Максимальное время жизни соединения
# Default: 1h
MBFLOW_DB_MAX_CONN_LIFETIME=1h

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================

# URL подключения к Redis
# Default: redis://localhost:6379
MBFLOW_REDIS_URL=redis://localhost:6379

# Пароль для Redis (если требуется)
# Default: (пусто)
MBFLOW_REDIS_PASSWORD=

# Номер базы данных Redis (0-15)
# Default: 0
MBFLOW_REDIS_DB=0

# Размер пула соединений Redis
# Default: 10
MBFLOW_REDIS_POOL_SIZE=10

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Уровень логирования: debug, info, warn, error
# Default: info
MBFLOW_LOG_LEVEL=info

# Формат логов: json или text
# json - структурированные логи для production
# text - человекочитаемые логи для разработки
# Default: json
MBFLOW_LOG_FORMAT=json

# =============================================================================
# OBSERVER CONFIGURATION
# Observers отслеживают события выполнения workflow
# =============================================================================

# --- Database Observer ---
# Сохранение событий в базу данных
# Default: true
MBFLOW_OBSERVER_DB_ENABLED=true

# --- Logger Observer ---
# Логирование событий
# Default: true
MBFLOW_OBSERVER_LOGGER_ENABLED=true

# --- WebSocket Observer ---
# Real-time трансляция событий через WebSocket
# Default: true
MBFLOW_OBSERVER_WEBSOCKET_ENABLED=true

# Размер буфера для WebSocket сообщений
# Default: 256
MBFLOW_OBSERVER_WEBSOCKET_BUFFER_SIZE=256

# --- HTTP Callback Observer ---
# Отправка событий на внешний HTTP endpoint
# Default: false
MBFLOW_OBSERVER_HTTP_ENABLED=false

# URL для HTTP callback
# Default: (пусто)
MBFLOW_OBSERVER_HTTP_URL=

# HTTP метод для callback (POST, PUT, PATCH)
# Default: POST
MBFLOW_OBSERVER_HTTP_METHOD=POST

# Таймаут HTTP запроса
# Default: 10s
MBFLOW_OBSERVER_HTTP_TIMEOUT=10s

# Максимальное количество попыток отправки
# Default: 3
MBFLOW_OBSERVER_HTTP_MAX_RETRIES=3

# Задержка между попытками
# Default: 1s
MBFLOW_OBSERVER_HTTP_RETRY_DELAY=1s

# Дополнительные HTTP заголовки
# Формат: Key1:Value1,Key2:Value2
# Default: (пусто)
# Пример: MBFLOW_OBSERVER_HTTP_HEADERS=Authorization:Bearer token,X-Custom:value
MBFLOW_OBSERVER_HTTP_HEADERS=

# --- General Observer Settings ---
# Размер общего буфера событий
# Default: 100
MBFLOW_OBSERVER_BUFFER_SIZE=100

# =============================================================================
# AUTHENTICATION CONFIGURATION
# =============================================================================

# Режим аутентификации:
# - builtin: встроенная JWT аутентификация (требуется MBFLOW_JWT_SECRET)
# - gateway: внешний auth gateway (требуется MBFLOW_AUTH_GATEWAY_URL, MBFLOW_AUTH_CLIENT_ID)
# - hybrid: оба варианта (требуются все настройки)
# Default: builtin
MBFLOW_AUTH_MODE=builtin

# --- JWT Configuration (для builtin/hybrid режимов) ---

# Секретный ключ для подписи JWT токенов
# ОБЯЗАТЕЛЬНО для builtin/hybrid режимов
# ВАЖНО: минимум 32 символа!
# Сгенерировать: openssl rand -base64 48
MBFLOW_JWT_SECRET=

# Время жизни access токена в часах
# Default: 24
MBFLOW_JWT_EXPIRATION_HOURS=24

# Время жизни refresh токена в днях
# Default: 30
MBFLOW_JWT_REFRESH_DAYS=30

# --- Session Settings ---

# Длительность сессии
# Default: 24h
MBFLOW_SESSION_DURATION=24h

# Максимальное количество активных сессий на пользователя
# Default: 5
MBFLOW_MAX_SESSIONS_PER_USER=5

# --- Password Policy ---

# Минимальная длина пароля (не менее 8)
# Default: 8
MBFLOW_MIN_PASSWORD_LENGTH=8

# Требовать специальные символы в пароле (!@#$%^&*...)
# Default: false
MBFLOW_REQUIRE_SPECIAL_CHARS=false

# Требовать заглавные буквы в пароле
# Default: false
MBFLOW_REQUIRE_UPPERCASE=false

# Требовать цифры в пароле
# Default: false
MBFLOW_REQUIRE_NUMBERS=false

# --- Rate Limiting ---

# Включить ограничение попыток входа
# Default: true
MBFLOW_ENABLE_RATE_LIMIT=true

# Максимальное количество неудачных попыток входа
# Default: 5
MBFLOW_MAX_LOGIN_ATTEMPTS=5

# Время блокировки после превышения лимита попыток
# Default: 15m
MBFLOW_LOCKOUT_DURATION=15m

# --- Registration ---

# Разрешить регистрацию новых пользователей
# Default: true
MBFLOW_ALLOW_REGISTRATION=true

# --- External Auth Gateway (для gateway/hybrid режимов) ---

# URL внешнего auth gateway
# ОБЯЗАТЕЛЬНО для gateway/hybrid режимов
MBFLOW_AUTH_GATEWAY_URL=

# Client ID для OAuth2
# ОБЯЗАТЕЛЬНО для gateway/hybrid режимов
MBFLOW_AUTH_CLIENT_ID=

# Client Secret для OAuth2
MBFLOW_AUTH_CLIENT_SECRET=

# Issuer URL для OIDC
MBFLOW_AUTH_ISSUER_URL=

# URL для получения JWKS (JSON Web Key Set)
MBFLOW_AUTH_JWKS_URL=

# URL редиректа после авторизации
MBFLOW_AUTH_REDIRECT_URL=

# --- Fallback Settings ---

# Включить fallback на другой режим при недоступности основного
# Default: false
MBFLOW_AUTH_ENABLE_FALLBACK=false

# Режим fallback (builtin или gateway)
# Default: builtin
MBFLOW_AUTH_FALLBACK_MODE=builtin

# =============================================================================
# FILE STORAGE CONFIGURATION
# =============================================================================

# Максимальный размер загружаемого файла в байтах
# Default: 10485760 (10 MB)
# Примеры: 5242880 (5MB), 52428800 (50MB), 104857600 (100MB)
MBFLOW_FILE_STORAGE_MAX_FILE_SIZE=10485760

# Путь для хранения загруженных файлов
# Default: ./data/storage
MBFLOW_FILE_STORAGE_PATH=./data/storage

# =============================================================================
# SERVICE KEYS CONFIGURATION
# Сервисные ключи для программного доступа к API
# =============================================================================

# Максимальное количество ключей на пользователя
# Default: 10
MBFLOW_SERVICE_KEYS_MAX_PER_USER=10

# Срок действия ключа по умолчанию в днях
# Default: 365
MBFLOW_SERVICE_KEYS_DEFAULT_EXPIRY_DAYS=365
